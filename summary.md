
## やったこと

### 得意なリソース毎に信頼エージェントを持つ
最も大きいリソースのインデックスがサブタスクのタイプになる。
そのタイプ毎に信頼エージェントをリーダーは持つ。
結果は良くなった。

### サブタスクのリソース数を３にする
1 or 3
結果は悪くなった。
サブタスクの選択戦略を変える。

### リーダーの関わるエージェントを狭める
十分に時間が経った後（学習が進んだ頃）にリーダーエージェントは、信頼度が高い順に上から100体エージェントを選んで、それ以降それらのエージェントにしかサブタスクを与えないようにする。
環境の負荷が小さいときは良い結果になったが、環境の負荷が大きいときは結果が悪くなった。

### サブタスク完了通知が来るまで同じメンバにサブタスクを渡さない
結果は悪くなった。１メンバあたりの保有サブタスクは減ってサブタスクキューを使っているアドバンテージが出ていない。

### 動的に関わるメンバを変更させる
関わるメンバ数 =　(メンバの平均サブタスク保有数 / サブタスクキューの最大値) * エージェント数
上の式で動的に変化させてみたが、負荷が大きい時にうまく対応できていない。

関わるメンバ数 = 100 ()
関わるメンバ数 = 関わるメンバ数 * (渡したサブタスク数) / (rejectされたサブタスク数)

### メンバが互恵行動をとる条件を変更する
信頼エージェントが3人いたら　→ 信頼エージェントが1人いたら
に変更。

↑ここの部分を動的に変えても良いかも。
タスクキューの空き具合によって増やしたり減らしたりする。

互恵行動をとる条件
```
（初期値）信頼エージェント == 1
if tick % 100 == 0
    if rejected_task == 0
        信頼エージェント += (タスクキューの平均空き数)
    else
        信頼エージェント = max(信頼エージェント - rejected_task, 1)
```

負荷が小さい時にwasted taskが多くなって成功率が下がっている。
wasted taskが多い　→ タスクキューの大きさに応じて

### 完全に信頼エージェントからのサブタスクしか受け付けない
互恵行動をとる条件が
信頼エージェント == 1
だと大幅に成功率が下がった。
信頼エージェント == 5
だと
信頼エージェント == 1
の時よりはいいがまだ良くない。

リーダー側の信頼エージェントかどうかを決める値を0.7 -> 1.5にしてみる
よくなったがまだrationalの方が良い
メンバ側の信頼エージェントかどうかを決める値も0.7 -> 1.5にしてみる
rationalよりもちょっと悪いぐらいだが、一番良い結果になっている

負荷を高くしてreciprocalの方がいいか確かめる。
ラムダ=18
の時同じくらい。
信頼エージェント == 3にしてみた
変わらず。

### 完全に信頼エージェント以外からのタスクも受け付ける


### わかったこと
リーダー側の信頼エージェントかどうかを決める値
1.5 -> 負荷が小さい時(10)に結果が良くなる。
負荷18
0.7 -> 負荷が大きめの時(18)に結果が1.5の時よりも良くなる。sccess rateは0.975ぐらい
0.5 -> 0.7とほぼ変わらず
0.3 -> 0.5,0.7より良い
0.1 -> さらに良い

負荷20
0.1 -> sccess rateは0.90行く時もある
0.7 -> 


負荷が大きいときは閾値が低い方が良い。
rejectedが多くなる→rejected task↑　閾値↓
負荷が小さいときは閾値が大きい方が良い。
wasetedが多くなる→waseted task↑　閾値↑

leader目線
rejectedが多くなる -> ある信頼メンバに集まりすぎている。信頼度の閾値を低くして信頼できるメンバを増やして分散させる。
wastedが多くなる -> あまりタスクをやってくれないメンバが信頼エージェントになっている。信頼度の閾値を高くして、質のいいメンバのみを信頼するようにする。

member目線、忙しかったら信頼エージェントからのタスクしか受け取らない。
rejectが多くなる -> leaderをもっと絞る必要がある。信頼度の閾値を増やす。
メンバの方は関係ないかも？

負荷10
1 -> 0.1
2 -> 0.3
3 -> 0.7
4 -> 1.0
5 -> 1.5

メンバ閾値
閾値0.001/tick 下げる 100tickに0.1
rejected taskが出たら0.1あげる。

リーダー閾値
rejected　->　0.1下げる
wasted -> 0.1あげる

## やること
### サブタスクのリソース数を３にする
サブタスクのリソース数が3の時にサブタスクの選択戦略を変える。

### リーダーの関わるエージェントを狭める
環境の負荷によって動的に関わるエージェントを狭める。
更新式を変える必要がありそう。

